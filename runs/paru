#!/usr/bin/env bash
set -euo pipefail

REPO_URL="https://aur.archlinux.org/paru.git"
TMP_DIR="$HOME/develop/.temp/paru-install"

sudo pacman -S --needed --noconfirm base-devel git

# Check if paru is already installed
if command -v paru >/dev/null 2>&1; then
    echo "paru is already installed"
    exit 0
fi

echo "Cloning paru into $TMP_DIR"
rm -rf "$TMP_DIR"
git clone "$REPO_URL" "$TMP_DIR"

cd "$TMP_DIR"
makepkg -si --noconfirm

# Cleanup
rm -rf "$TMP_DIR"
echo "Removed temporary build directory: $TMP_DIR"

# Confirm installation
if command -v paru >/dev/null 2>&1; then
    echo "paru successfully installed"
else
    echo "paru installation failed"
    exit 1
fi
