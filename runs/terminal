#!/usr/bin/env bash
set -euo pipefail

paru -S --needed --noconfirm zsh wezterm starship

# Initialize zsh config if missing
if [[ ! -f "$HOME/.zshrc" ]]; then
    echo "Running zsh to generate initial config at $HOME/.zshrc"
    zsh -c "exit"
fi

# Change default shell to zsh if not already
if [[ "$SHELL" != "/bin/zsh" ]]; then
    echo "Changing default shell to /bin/zsh"
    chsh -s /bin/zsh
else
    echo "Default shell is already /bin/zsh"
fi

# Add starship init to shell profile
LINE='eval "$(starship init zsh)"'
if ! grep -Fxq "$LINE" "$SHELL_PROFILE"; then
    echo -e "\n# Added by Starship setup\n$LINE" >> "$SHELL_PROFILE"
    echo "Added starship init to $SHELL_PROFILE: $LINE"
else
    echo "Starship init already present in $SHELL_PROFILE"
fi

